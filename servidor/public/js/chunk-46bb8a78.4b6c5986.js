(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46bb8a78"],{"2a2e":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"application-container"},[s("Aside"),s("main",[s("h1",{staticClass:"mb-3"},[e._v("Permisos")]),s("div",{staticClass:"info-card"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm-4"},[s("div",{staticClass:"add-button",on:{click:function(t){return e.showNewRolModal()}}},[e._m(0)])]),s("div",{staticClass:"col-sm-8"},[s("div",{staticClass:"add-button",on:{click:function(t){return e.showNewSpecialUserModal()}}},[e._m(1)])])]),s("div",{staticClass:"row mt-2"},[s("div",{staticClass:"col-md-4"},[e._m(2),e._l(e.roles,(function(t){return s("div",{key:t.id,staticClass:"role-card mb-1"},[s("div",{on:{click:function(s){return e.showManageRoleModal(t)}}},[e._v(e._s(t.name))]),"Admin"!=t.name?s("div",{on:{click:function(s){return e.deleteRole(t)}}},[s("span",{staticClass:"material-icons-sharp active"},[e._v("")])]):s("div")])}))],2),s("div",{staticClass:"col-md-8"},[e._m(3),e._l(e.users,(function(t){return s("div",{key:t.id,staticClass:"role-user-card mt-2",on:{click:function(s){return e.showManageRolesUser(t)}}},[s("div",[s("b",{staticStyle:{color:"var(--color-primary)"}},[e._v(e._s(t.id)+".")]),e._v(" "+e._s(t.name+" "+t.last_name))]),s("div",{staticStyle:{display:"flex","justify-content":"flex-end",gap:"5px"}},e._l(t.roles,(function(t){return s("div",{key:t.id,staticClass:"roles-section"},[s("span",{staticClass:"count"},[e._v(e._s(t.name))])])})),0)])}))],2)])])]),s("Right"),s("div",{staticClass:"modal fade",attrs:{id:"modal-new-role",tabindex:"-1","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[e._m(4),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12 mb-2"},[s("p",[e._v("Nombre")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.role.name,expression:"role.name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.role.name},on:{input:function(t){t.target.composing||e.$set(e.role,"name",t.target.value)}}})])])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.registerRole()}}},[e._v("Registrar")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"modal-new-special-user",tabindex:"-1","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[e._m(5),s("div",{staticClass:"modal-body"},[s("p",[e._v("Seleccionar Usuario")]),s("UserSearch",{attrs:{search:e.resultSearch}}),s("hr"),s("p",[e._v("Roles")]),s("div",{staticClass:"row"},e._l(e.roles,(function(t){return s("div",{key:"a-"+t.id,staticClass:"col-md-4"},[s("div",{staticClass:"custom-control custom-checkbox"},[s("input",{staticClass:"custom-control-input",attrs:{type:"checkbox",id:"role-check-"+t.id},domProps:{value:t.id},on:{change:function(s){return e.manageUserRoles(t.id)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"role-check-"+t.id}},[e._v(" "+e._s(t.name)+" ")])])])})),0)],1),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.registerRoleUser()}}},[e._v("Registrar")])])])])]),s("div",{staticClass:"modal fade",attrs:{id:"modal-update-special-user",tabindex:"-1","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[e._m(6),s("div",{staticClass:"modal-body"},[s("p",[e._v("Usuario")]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"form-control"},[e._v(e._s(this.user.id))])]),s("div",{staticClass:"col-md-8"},[s("div",{staticClass:"form-control"},[e._v(e._s(this.user.name)+" "+e._s(this.user.last_name))])])]),s("hr"),s("p",[e._v("Roles")]),s("div",{staticClass:"row"},e._l(e.user.roles,(function(t){return s("div",{key:t.id,staticClass:"col-md-4"},[s("div",{staticClass:"custom-control custom-checkbox"},[s("input",{staticClass:"custom-control-input",attrs:{type:"checkbox",disabled:"disabled"},domProps:{checked:!0}}),s("label",{staticClass:"custom-control-label"},[e._v(" "+e._s(t.name)+" ")])])])})),0)]),s("div",{staticClass:"modal-footer"},[e.userIsAdmin()?s("button",{staticClass:"btn btn-danger",on:{click:function(t){return e.removeAllRoleOfUser()}}},[s("span",{staticStyle:{"font-size":"1rem"}},[e._v("Eliminar")])]):e._e()])])])]),s("div",{staticClass:"modal fade",attrs:{id:"modal-manage-role",tabindex:"-1","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h3",{staticClass:"modal-title"},[e._v(" "+e._s(e.role.name.toUpperCase())+" - ROLE ")]),e._m(7)]),s("div",{staticClass:"modal-body",staticStyle:{"max-height":"450px","overflow-y":"scroll"}},[s("div",{staticClass:"row",staticStyle:{"margin-right":"0"}},[e._m(8),e._l(e.permissions,(function(t){return s("div",{key:t.id,staticClass:"col-sm-6"},[s("div",{staticClass:"custom-control custom-checkbox"},[s("input",{staticClass:"custom-control-input",attrs:{type:"checkbox",id:"permission-check-"+t.id},domProps:{value:t.id,checked:e.validateRolePermission(t.id)},on:{change:function(s){return e.manageRolePermissions(t.id)}}}),s("label",{staticClass:"custom-control-label",attrs:{for:"permission-check-"+t.id}},[e._v(" "+e._s(t.name)+" ")])])])}))],2)])])])])],1)},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("span",{staticClass:"material-icons-sharp"},[e._v("")]),e._v("Nuevo Rol")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("span",{staticClass:"material-icons-sharp"},[e._v("")]),e._v("Nuevo Usuario Especial")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h3",{staticClass:"mb-1"},[s("b",[e._v("Roles")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("h3",{staticClass:"mb-1"},[s("b",[e._v("Usuarios Especiales")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-header"},[s("h3",{staticClass:"modal-title"},[e._v("REGISTRAR ROL")]),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-header"},[s("h3",{staticClass:"modal-title"},[e._v(" ASIGNAR ROL A USUARIO ")]),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-header"},[s("h3",{staticClass:"modal-title"},[e._v(" ROLES DE USUARIO ")]),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col-md-12"},[s("h3",[s("b",[e._v("Permisos")])])])}],o=s("5530"),r=(s("7db0"),s("d3b7"),s("b0c0"),s("159b"),s("4de4"),s("498a"),s("bc3a")),n=s.n(r),l=s("2f62"),c=s("3d13"),d=s("8084"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-4 mb-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.search_code,expression:"search_code"}],staticClass:"form-control",attrs:{type:"number",placeholder:"Buscar código..."},domProps:{value:e.search_code},on:{input:function(t){t.target.composing||(e.search_code=t.target.value)}}})]),s("div",{staticClass:"col-md-8"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.selected_user,expression:"selected_user"}],staticClass:"form-control",on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selected_user=t.target.multiple?s:s[0]},function(t){return e.changeSelectedUser(e.selected_user)}]}},[e.users.length<=0&&e.search_code?s("option",{attrs:{value:"",selected:"",disabled:""}},[e._v("Usuario no encontrado")]):e._e(),e._l(e.users,(function(t){return s("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.id+" | "+t.name+" "))])}))],2)])])},m=[],h=(s("ac1f"),s("841c"),{props:["search"],data:function(){return{search_code:"",selected_user:"",users:[]}},methods:{searchUser:function(e){var t=this,s=this.api_url+"/api/search/public/users";n.a.post(s,e,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((function(e){t.users=e.data,e.data.length>0?t.selected_user=e.data[0].id:t.selected_user="",t.search(t.selected_user)})).catch((function(e){return console.log(e.response)}))},changeSelectedUser:function(e){this.search(e)}},mounted:function(){this.searchUser({search:"",order:"DESC",limit:20})},computed:Object(o["a"])({},Object(l["d"])(["api_url"])),watch:{search_code:function(){this.searchUser({search:this.search_code,order:"ASC",limit:20})}}}),v=h,p=s("0c7c"),f=Object(p["a"])(v,u,m,!1,null,null,null),_=f.exports,b={name:"Permissions",components:{Aside:c["a"],Right:d["a"],UserSearch:_},data:function(){return{role:{id:"",name:"",permissions:[]},user_search:"",user:{id:"",name:"",last_name:"",roles:[]},selected_roles:[]}},methods:Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])({resultSearch:function(e){this.user_search=e},userIsAdmin:function(){var e=this.user.roles.find((function(e){return"Admin"==e.name}));return!e},removeAllRoleOfUser:function(){var e=this;this.$swal.fire({title:"¿Estás seguro que deseas eliminar este usuario especial?",html:"Al eliminar el usuario especial perderá acceso a las páginas asignadas",showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then((function(t){if(t.isConfirmed)return e.user.roles.forEach((function(t){1!=t.id&&(console.log(t),e.removeRoleUser(t.id))})),e.getUsersWithRoles(),$("#modal-update-special-user").modal("hide"),e.launchAlert({type:"success",title:"Usuario especial removido exitosamente"})}))},registerRoleUser:function(){var e=this;return this.user_search?this.selected_roles.length<=0?this.launchAlert({type:"warning",title:"Selecciona al menos un rol"}):void this.selected_roles.forEach((function(t){e.registerRoleToUser({role_id:t,user_id:e.user_search}).then((function(t){201==t.status&&(e.getUsersWithRoles(),$("#modal-new-special-user").modal("hide"),e.launchAlert({type:"success",title:"Usuario especial registrado exitosamente"}))})).catch((function(e){return console.log(e)}))})):this.launchAlert({type:"warning",title:"Selecciona un usuairo válido"})},removeRoleUser:function(e){var t=this,s=this.api_url+"/api/roles/remove_user";n.a.post(s,{role_id:e,user_id:this.user.id},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((function(){t.getUsersWithRoles()})).catch((function(e){console.log(e)}))},validateuserRoles:function(e){var t=this.user.roles.find((function(t){return t.id==e}));return!!t},validateRolePermission:function(e){var t=this.role.permissions.find((function(t){return t.id==e}));return!!t},manageUserRoles:function(e){var t=this.selected_roles.find((function(t){return t==e}));t?this.selected_roles=this.selected_roles.filter((function(t){return t!=e})):this.selected_roles.push(e)},manageRolePermissions:function(e){var t=document.getElementById("permission-check-".concat(e));if(1==this.role.id)return t.checked=!0,this.launchAlert({type:"warning",title:"No está permitido editar permisos del administrador"});t.checked?this.addRolePermission(e):this.removeRolePermission(e)},registerRole:function(){var e=this;if(!this.role.name.trim())return this.launchAlert({type:"warning",title:"Registra un nombre válido"});var t=this.api_url+"/api/roles/create";n.a.post(t,{name:this.role.name.trim()},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((function(t){if(201==t.status)return e.role.id="",e.role.name="",e.getRoles(),$("#modal-new-role").modal("hide"),e.launchAlert({type:"success",title:"Rol registrado exitosamente"})})).catch((function(t){if(console.log(t.response),400==t.response.status)return e.launchAlert({type:"error",title:"Digita un nombre de rol válido o que no se encuentre repetido"})}))},deleteRole:function(e){var t=this;this.$swal.fire({title:"¿Estás seguro que deseas eliminar este rol?",html:"Se debe en cuenta que si eliminas este rol muchos usuarios podrán perder acceso a partes importantes del sistema",showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Cancelar"}).then((function(s){if(s.isConfirmed){var a=t.api_url+"/api/roles/".concat(e.id);n.a.delete(a,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((function(e){if(200==e.status)return t.getRoles(),t.launchAlert({type:"success",title:"Rol eliminado exitosamente"})})).catch((function(e){console.log(e.response)}))}}))},addRolePermission:function(e){var t={role_id:this.role.id,permission_id:e},s=this.api_url+"/api/roles/add_permission";n.a.post(s,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}})},removeRolePermission:function(e){var t={role_id:this.role.id,permission_id:e},s=this.api_url+"/api/roles/remove_permission";n.a.post(s,t,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}})},showNewRolModal:function(){this.user={roles:[]},this.role.name="",$("#modal-new-role").modal("show")},showManageRolesUser:function(e){this.user.roles=[],this.user.id=e.id,this.user.name=e.name,this.user.last_name=e.last_name,this.user.roles=e.roles,$("#modal-update-special-user").modal("show")},showNewSpecialUserModal:function(){this.role.name="",$("#modal-new-special-user").modal("show")},showManageRoleModal:function(e){this.role.id=e.id,this.role.name=e.name,this.getRolePermissions(e.id),$("#modal-manage-role").modal("show")},getRolePermissions:function(e){var t=this,s=this.api_url+"/api/roles/".concat(e);n.a.get(s,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then((function(e){t.role.permissions=e.data.permissions})).catch((function(e){return console.log(e.response)}))},launchAlert:function(e){e.timeout||(e.timeout=2500);var t=this.$swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:e.timeout});t.fire({icon:e.type,title:e.title,text:e.message})}},Object(l["b"])("user",["getUsersLine"])),Object(l["b"])("permission",["registerRoleToUser"])),Object(l["c"])("permission",["getRoles"])),Object(l["c"])("permission",["getPermissions"])),Object(l["c"])("permission",["getUsersWithRoles"])),Object(l["c"])(["loadSessionUser"])),mounted:function(){$(".modal-backdrop").remove(),this.getRoles(),this.getPermissions(),this.getUsersWithRoles(),this.loadSessionUser()},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(l["d"])(["api_url"])),Object(l["d"])(["session_user"])),Object(l["d"])("permission",["users"])),Object(l["d"])("permission",["roles"])),Object(l["d"])("permission",["permissions"]))},g=b,C=(s("abd0"),Object(p["a"])(g,a,i,!1,null,null,null));t["default"]=C.exports},"498a":function(e,t,s){"use strict";var a=s("23e7"),i=s("58a8").trim,o=s("c8d2");a({target:"String",proto:!0,forced:o("trim")},{trim:function(){return i(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,s){var a=s("e330"),i=s("1d80"),o=s("577e"),r=s("5899"),n=a("".replace),l="["+r+"]",c=RegExp("^"+l+l+"*"),d=RegExp(l+l+"*$"),u=function(e){return function(t){var s=o(i(t));return 1&e&&(s=n(s,c,"")),2&e&&(s=n(s,d,"")),s}};e.exports={start:u(1),end:u(2),trim:u(3)}},a62e:function(e,t,s){},abd0:function(e,t,s){"use strict";s("a62e")},c8d2:function(e,t,s){var a=s("5e77").PROPER,i=s("d039"),o=s("5899"),r="​᠎";e.exports=function(e){return i((function(){return!!o[e]()||r[e]()!==r||a&&o[e].name!==e}))}}}]);
//# sourceMappingURL=chunk-46bb8a78.4b6c5986.js.map